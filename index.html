<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATE Core System - Лист персонажа</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .diamond {
            transform: rotate(45deg);
            width: 20px;
            height: 20px;
        }
        .diamond.checked {
            background-color: #f59e0b;
        }
        .diamond.unchecked {
            background-color: #9ca3af;
        }
        .fate-die {
            width: 40px;
            height: 40px;
            border: 2px solid #4b5563;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin: 4px;
        }
        .fate-plus { color: #10b981; }
        .fate-minus { color: #ef4444; }
        .fate-blank { color: #6b7280; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Default character data from the uploaded file
        const defaultCharacterData = {
          "name": "Jack Pocket Knife",
          "description": "Малютка Джек был столь мал, что от прозвища \"Перочинный нож\" ему было не уйти.",
          "aspects": {
            "concept": "Аферист в робе пастора",
            "problem": "Скрывается от нанимателя с краденным артефактом",
            "aspect1": "Почти дварф",
            "aspect2": "Зудящие ладошки",
            "aspect3": "Безбожный шутник"
          },
          "skills": [
            ["", "", "", "", ""],
            ["Атлетика", "", "", "", ""],
            ["Телосложение", "Скрытность", "", "", ""],
            ["Обман", "Воля", "", "", ""],
            ["Меткость", "Разум", "Проницательность", "", ""]
          ],
          "extras": "",
          "stunts": "1. Взломщик (тихий взлом через скрытность)\n2. Опытный карманник (за 1 жетон без проверки незаметно забираешь мелкий предмет)\n3. Глупая шутка (эта шутка настолько плоха, что даже хороша -- вызывает безудержный поток хохота)",
          "physicalStress": [false, false, false],
          "mentalStress": [false, false, false],
          "unnamedStress": [false, false, false, false, false],
          "consequences": {
            "light": "",
            "moderate": "",
            "severe": ""
          },
          "inventory": "0. Книга с черными страницами\n1. Метательные ножи (6 шт)\n2. Отмычки\n3. Серебряное распятие",
          "tokens": [true, true, true, false, false, false, false, false, false, false]
        };

        function App() {
            const [darkMode, setDarkMode] = useState(true);
            const [expandedSections, setExpandedSections] = useState({
                character: true,
                aspects: true,
                skills: true,
                extras: true,
                stunts: true,
                stress: true,
                consequences: true,
                inventory: true,
                tokens: true,
                dice: true
            });

            const [characterData, setCharacterData] = useState(defaultCharacterData);
            const [diceCount, setDiceCount] = useState(4);
            const [currentRoll, setCurrentRoll] = useState(null);
            const [rollHistory, setRollHistory] = useState([]);
            const fileInputRef = useRef(null);
            const menuRef = useRef(null);
            const [menuOpen, setMenuOpen] = useState(false);

            // Close menu when clicking outside
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target) && menuOpen) {
                        setMenuOpen(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [menuOpen]);

            const toggleSection = (section) => {
                setExpandedSections(prev => ({
                    ...prev,
                    [section]: !prev[section]
                }));
            };

            const handleInputChange = (field, value, subField = null) => {
                if (subField) {
                    setCharacterData(prev => ({
                        ...prev,
                        [field]: {
                            ...prev[field],
                            [subField]: value
                        }
                    }));
                } else {
                    setCharacterData(prev => ({
                        ...prev,
                        [field]: value
                    }));
                }
            };

            const handleSkillChange = (row, col, value) => {
                const newSkills = [...characterData.skills];
                newSkills[row][col] = value;
                setCharacterData(prev => ({
                    ...prev,
                    skills: newSkills
                }));
            };

            const handleCheckboxChange = (type, index, checked) => {
                if (type === 'physicalStress') {
                    const newStress = [...characterData.physicalStress];
                    newStress[index] = checked;
                    setCharacterData(prev => ({
                        ...prev,
                        physicalStress: newStress
                    }));
                } else if (type === 'mentalStress') {
                    const newStress = [...characterData.mentalStress];
                    newStress[index] = checked;
                    setCharacterData(prev => ({
                        ...prev,
                        mentalStress: newStress
                    }));
                } else if (type === 'unnamedStress') {
                    const newStress = [...characterData.unnamedStress];
                    newStress[index] = checked;
                    setCharacterData(prev => ({
                        ...prev,
                        unnamedStress: newStress
                    }));
                } else if (type === 'tokens') {
                    const newTokens = [...characterData.tokens];
                    newTokens[index] = checked;
                    setCharacterData(prev => ({
                        ...prev,
                        tokens: newTokens
                    }));
                }
            };

            const exportToJSON = () => {
                const dataStr = JSON.stringify(characterData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const exportFileDefaultName = `${characterData.name.replace(/\s+/g, '_')}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', url);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                // Clean up
                URL.revokeObjectURL(url);
                setMenuOpen(false);
            };

            const importFromJSON = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        setCharacterData(importedData);
                    } catch (error) {
                        alert('Ошибка при импорте файла. Убедитесь, что это корректный JSON файл.');
                    }
                };
                reader.readAsText(file);
                setMenuOpen(false);
            };

            const toggleTheme = () => {
                setDarkMode(!darkMode);
                setMenuOpen(false);
            };

            const activeTokens = characterData.tokens.filter(token => token).length;

            const getDieDisplay = (value) => {
                if (value === 1) return '+';
                if (value === -1) return '-';
                return '•';
            };

            const getDieClass = (value) => {
                if (value === 1) return 'fate-plus';
                if (value === -1) return 'fate-minus';
                return 'fate-blank';
            };

            const rollDice = () => {
                const results = [];
                let total = 0;
                
                for (let i = 0; i < diceCount; i++) {
                    const roll = Math.floor(Math.random() * 3) - 1; // -1, 0, +1
                    results.push(roll);
                    total += roll;
                }
                
                const rollData = {
                    id: Date.now(),
                    dice: results,
                    total: total,
                    timestamp: new Date().toLocaleTimeString()
                };
                
                setCurrentRoll(rollData);
                setRollHistory(prev => [rollData, ...prev.slice(0, 9)]); // Keep last 10 rolls
            };

            return (
                <div className={`min-h-screen p-4 ${darkMode ? 'bg-gray-900 text-white' : 'bg-white text-black'}`}>
                    {/* Header with hamburger menu */}
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-3xl font-bold">FATE Core System</h1>
                        <div className="relative" ref={menuRef}>
                            <button 
                                onClick={() => setMenuOpen(!menuOpen)}
                                className="p-2 rounded-md bg-gray-700 hover:bg-gray-600"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                            </button>
                            
                            {menuOpen && (
                                <div className="absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-gray-800 ring-1 ring-black ring-opacity-5 z-10">
                                    <div className="py-1">
                                        <button 
                                            onClick={toggleTheme}
                                            className="block px-4 py-2 text-sm text-white hover:bg-gray-700 w-full text-left"
                                        >
                                            {darkMode ? 'Светлая тема' : 'Темная тема'}
                                        </button>
                                        <button 
                                            onClick={exportToJSON}
                                            className="block px-4 py-2 text-sm text-white hover:bg-gray-700 w-full text-left"
                                        >
                                            Экспорт в JSON
                                        </button>
                                        <label className="block px-4 py-2 text-sm text-white hover:bg-gray-700 w-full text-left cursor-pointer">
                                            Импорт из JSON
                                            <input 
                                                type="file" 
                                                ref={fileInputRef}
                                                onChange={importFromJSON}
                                                accept=".json"
                                                className="hidden"
                                            />
                                        </label>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Character Sheet */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Left Column */}
                        <div className="space-y-6">
                            {/* Character Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('character')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>ПЕРСОНАЖ</span>
                                    <span>{expandedSections.character ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.character && (
                                    <div className="p-4 space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Имя</label>
                                            <input 
                                                type="text" 
                                                value={characterData.name}
                                                onChange={(e) => handleInputChange('name', e.target.value)}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Описание</label>
                                            <textarea 
                                                rows={5}
                                                value={characterData.description}
                                                onChange={(e) => handleInputChange('description', e.target.value)}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Aspects Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('aspects')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>АСПЕКТЫ</span>
                                    <span>{expandedSections.aspects ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.aspects && (
                                    <div className="p-4 space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Концепция</label>
                                            <input 
                                                type="text" 
                                                value={characterData.aspects.concept}
                                                onChange={(e) => handleInputChange('aspects', e.target.value, 'concept')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Проблема</label>
                                            <input 
                                                type="text" 
                                                value={characterData.aspects.problem}
                                                onChange={(e) => handleInputChange('aspects', e.target.value, 'problem')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <input 
                                                type="text" 
                                                value={characterData.aspects.aspect1}
                                                onChange={(e) => handleInputChange('aspects', e.target.value, 'aspect1')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <input 
                                                type="text" 
                                                value={characterData.aspects.aspect2}
                                                onChange={(e) => handleInputChange('aspects', e.target.value, 'aspect2')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <input 
                                                type="text" 
                                                value={characterData.aspects.aspect3}
                                                onChange={(e) => handleInputChange('aspects', e.target.value, 'aspect3')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Extras Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('extras')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>ДОПОЛНЕНИЯ</span>
                                    <span>{expandedSections.extras ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.extras && (
                                    <div className="p-4">
                                        <textarea 
                                            rows={5}
                                            value={characterData.extras}
                                            onChange={(e) => handleInputChange('extras', e.target.value)}
                                            className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                        />
                                    </div>
                                )}
                            </div>

                            {/* Stress Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('stress')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>СТРЕСС</span>
                                    <span>{expandedSections.stress ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.stress && (
                                    <div className="p-4 space-y-4">
                                        <div>
                                            <h3 className="font-medium mb-2">Физический стресс</h3>
                                            <div className="flex space-x-4">
                                                {[1, 2, 3].map((num, i) => (
                                                    <div key={i} className="flex items-center">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={characterData.physicalStress[i]}
                                                            onChange={(e) => handleCheckboxChange('physicalStress', i, e.target.checked)}
                                                            className="mr-2 h-5 w-5"
                                                        />
                                                        <span>{num}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div>
                                            <h3 className="font-medium mb-2">Ментальный стресс</h3>
                                            <div className="flex space-x-4">
                                                {[1, 2, 3].map((num, i) => (
                                                    <div key={i} className="flex items-center">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={characterData.mentalStress[i]}
                                                            onChange={(e) => handleCheckboxChange('mentalStress', i, e.target.checked)}
                                                            className="mr-2 h-5 w-5"
                                                        />
                                                        <span>{num}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div>
                                            <hr className="my-2" />
                                            <div className="flex space-x-4">
                                                {[1, 2, 3, 4, 5].map((num, i) => (
                                                    <div key={i} className="flex items-center">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={characterData.unnamedStress[i]}
                                                            onChange={(e) => handleCheckboxChange('unnamedStress', i, e.target.checked)}
                                                            className="mr-2 h-5 w-5"
                                                        />
                                                        <span>{num}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Dice Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('dice')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>КУБЫ</span>
                                    <span>{expandedSections.dice ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.dice && (
                                    <div className="p-4 space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Количество кубов</label>
                                            <select 
                                                value={diceCount}
                                                onChange={(e) => setDiceCount(parseInt(e.target.value))}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            >
                                                {[1,2,3,4,5,6,7,8,9,10].map(num => (
                                                    <option key={num} value={num}>{num}</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <button 
                                            onClick={rollDice}
                                            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                                        >
                                            Бросить кубы
                                        </button>
                                        
                                        {currentRoll && (
                                            <div className="space-y-2">
                                                <h4 className="font-medium">Результат броска:</h4>
                                                <div className="flex flex-wrap justify-center">
                                                    {currentRoll.dice.map((die, index) => (
                                                        <div key={index} className={`fate-die ${getDieClass(die)}`}>
                                                            {getDieDisplay(die)}
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="text-center font-bold text-lg">
                                                    Сумма: {currentRoll.total}
                                                </div>
                                            </div>
                                        )}
                                        
                                        {rollHistory.length > 0 && (
                                            <div className="space-y-2">
                                                <h4 className="font-medium">История бросков:</h4>
                                                <div className="space-y-1 max-h-32 overflow-y-auto">
                                                    {rollHistory.map(roll => (
                                                        <div key={roll.id} className="text-sm flex justify-between items-center bg-gray-800 p-2 rounded">
                                                            <span>{roll.timestamp}</span>
                                                            <span className="font-mono">Сумма: {roll.total}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="mt-4 p-3 bg-gray-800 rounded">
                                            <h4 className="font-medium mb-2">Памятка по кубам FATE:</h4>
                                            <ul className="text-sm space-y-1">
                                                <li>1–2 на d6 = <span className="text-red-400 font-bold">-1</span></li>
                                                <li>3–4 на d6 = <span className="text-gray-400 font-bold">0</span></li>
                                                <li>5–6 на d6 = <span className="text-green-400 font-bold">+1</span></li>
                                                <li>Стандартный бросок: 4 куба + модификатор навыка</li>
                                            </ul>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Right Column */}
                        <div className="space-y-6">
                            {/* Skills Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('skills')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>НАВЫКИ</span>
                                    <span>{expandedSections.skills ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.skills && (
                                    <div className="p-4">
                                        <div className="grid grid-cols-6 gap-2">
                                            {/* Level labels */}
                                            <div className="font-medium">Великолепн. (+5)</div>
                                            <input 
                                                type="text" 
                                                value={characterData.skills[0][0] || ""}
                                                onChange={(e) => handleSkillChange(0, 0, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[0][1] || ""}
                                                onChange={(e) => handleSkillChange(0, 1, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[0][2] || ""}
                                                onChange={(e) => handleSkillChange(0, 2, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[0][3] || ""}
                                                onChange={(e) => handleSkillChange(0, 3, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[0][4] || ""}
                                                onChange={(e) => handleSkillChange(0, 4, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            
                                            <div className="font-medium">Отличный (+4)</div>
                                            <input 
                                                type="text" 
                                                value={characterData.skills[1][0] || ""}
                                                onChange={(e) => handleSkillChange(1, 0, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[1][1] || ""}
                                                onChange={(e) => handleSkillChange(1, 1, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[1][2] || ""}
                                                onChange={(e) => handleSkillChange(1, 2, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[1][3] || ""}
                                                onChange={(e) => handleSkillChange(1, 3, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[1][4] || ""}
                                                onChange={(e) => handleSkillChange(1, 4, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            
                                            <div className="font-medium">Хороший (+3)</div>
                                            <input 
                                                type="text" 
                                                value={characterData.skills[2][0] || ""}
                                                onChange={(e) => handleSkillChange(2, 0, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[2][1] || ""}
                                                onChange={(e) => handleSkillChange(2, 1, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[2][2] || ""}
                                                onChange={(e) => handleSkillChange(2, 2, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[2][3] || ""}
                                                onChange={(e) => handleSkillChange(2, 3, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[2][4] || ""}
                                                onChange={(e) => handleSkillChange(2, 4, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            
                                            <div className="font-medium">Неплохой (+2)</div>
                                            <input 
                                                type="text" 
                                                value={characterData.skills[3][0] || ""}
                                                onChange={(e) => handleSkillChange(3, 0, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[3][1] || ""}
                                                onChange={(e) => handleSkillChange(3, 1, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[3][2] || ""}
                                                onChange={(e) => handleSkillChange(3, 2, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[3][3] || ""}
                                                onChange={(e) => handleSkillChange(3, 3, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[3][4] || ""}
                                                onChange={(e) => handleSkillChange(3, 4, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            
                                            <div className="font-medium">Средний (+1)</div>
                                            <input 
                                                type="text" 
                                                value={characterData.skills[4][0] || ""}
                                                onChange={(e) => handleSkillChange(4, 0, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[4][1] || ""}
                                                onChange={(e) => handleSkillChange(4, 1, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[4][2] || ""}
                                                onChange={(e) => handleSkillChange(4, 2, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[4][3] || ""}
                                                onChange={(e) => handleSkillChange(4, 3, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                            <input 
                                                type="text" 
                                                value={characterData.skills[4][4] || ""}
                                                onChange={(e) => handleSkillChange(4, 4, e.target.value)}
                                                className={`p-1 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Stunts Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('stunts')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>ТРЮКИ</span>
                                    <span>{expandedSections.stunts ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.stunts && (
                                    <div className="p-4">
                                        <textarea 
                                            rows={5}
                                            value={characterData.stunts}
                                            onChange={(e) => handleInputChange('stunts', e.target.value)}
                                            className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                        />
                                    </div>
                                )}
                            </div>

                            {/* Consequences Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('consequences')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>ПОСЛЕДСТВИЯ</span>
                                    <span>{expandedSections.consequences ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.consequences && (
                                    <div className="p-4 space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Легкое</label>
                                            <input 
                                                type="text" 
                                                value={characterData.consequences.light}
                                                onChange={(e) => handleInputChange('consequences', e.target.value, 'light')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Среднее</label>
                                            <input 
                                                type="text" 
                                                value={characterData.consequences.moderate}
                                                onChange={(e) => handleInputChange('consequences', e.target.value, 'moderate')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Тяжелое</label>
                                            <input 
                                                type="text" 
                                                value={characterData.consequences.severe}
                                                onChange={(e) => handleInputChange('consequences', e.target.value, 'severe')}
                                                className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                            />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Inventory Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('inventory')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>ИНВЕНТАРЬ</span>
                                    <span>{expandedSections.inventory ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.inventory && (
                                    <div className="p-4">
                                        <textarea 
                                            rows={5}
                                            value={characterData.inventory}
                                            onChange={(e) => handleInputChange('inventory', e.target.value)}
                                            className={`w-full p-2 rounded border ${darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
                                        />
                                    </div>
                                )}
                            </div>

                            {/* Tokens Block */}
                            <div className={`rounded-md border ${darkMode ? 'border-gray-700' : 'border-gray-300'}`}>
                                <button 
                                    onClick={() => toggleSection('tokens')}
                                    className={`w-full p-2 text-left font-bold ${darkMode ? 'bg-gray-800' : 'bg-gray-200'} flex justify-between items-center`}
                                >
                                    <span>ЖЕТОНЫ</span>
                                    <span>{expandedSections.tokens ? '▼' : '▶'}</span>
                                </button>
                                {expandedSections.tokens && (
                                    <div className="p-4">
                                        <div className="flex flex-wrap gap-3 items-center">
                                            {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((i) => (
                                                <div key={i} className="flex items-center">
                                                    <input 
                                                        type="checkbox" 
                                                        checked={characterData.tokens[i]}
                                                        onChange={(e) => handleCheckboxChange('tokens', i, e.target.checked)}
                                                        className="mr-2 h-5 w-5"
                                                    />
                                                    <div className={`diamond ${characterData.tokens[i] ? 'checked' : 'unchecked'}`}></div>
                                                </div>
                                            ))}
                                            <div className="ml-4 font-medium">
                                                Всего: {activeTokens}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

